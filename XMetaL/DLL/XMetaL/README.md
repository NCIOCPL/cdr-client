# Generated XMetaL interface files

The files in this directory were generated using Visual Studio 2019's wizard for generating MFC class wrappers from TypeLib files (`Project > Add New Item... > MFC Class From TypeLib`). They have been moved to this subdirectory so they won't clutter up the main project directory. We only need the dozen classes found here, as they represent the only XMetaL APIs we currently use.

## Manual Adjustments

We needed to make some tweaks by hand to the header files generated by Microsoft.

### Missing Arguments

In a half-dozen or so cases, class member function definitions contained invalid syntax caused by a missing argument in the `InvokeHelper()` call. For example:

```cpp
	LPUNKNOWN get_FX()
	{
		LPUNKNOWN result;
		InvokeHelper(0xa, DISPATCH_PROPERTYGET, , (void*)&result, NULL);
		return result;
	}
```

which needed to be corrected to

```cpp
	LPUNKNOWN get_FX()
	{
		LPUNKNOWN result;
		InvokeHelper(0xa, DISPATCH_PROPERTYGET, VT_UNKNOWN, (void*)&result, NULL);
		return result;
	}
```

In each case we were able to figure out what needed to be inserted by looking at the return type of the member function and using the following mappings:
- For functions returning `LPUNKNOWN` insert `VT_UNKNOWN`
- for functions returning `unsigned short` insert `VT_UI2`
- for functions returning `__int64` insert `VT_I8`

See Microsoft's [documentation for variant types](https://learn.microsoft.com/en-us/windows/win32/api/wtypes/ne-wtypes-varenum) and [this more explicit table](https://www.quickmacros.com/help/Tables/IDP_VARIANT.html).

I have [reported this bug to Microsoft](https://developercommunity.visualstudio.com/t/Visual-Studio-2022-generates-invalid-syn/10206982). See also this [Stack Overflow post](https://stackoverflow.com/questions/74499468).

### Name Conflict Resolution

In one case, a class name needed to be modified because it clashed with the [MFC `CDocument` class](https://learn.microsoft.com/en-us/cpp/mfc/reference/cdocument-class). The solution adopted was to
- rename `CDocument.h` to `CDocument0.h`
- change all occurrences of "CDocument" in that header to "CDocument0"

Our own code, of course, uses the modified class name.

The ideal solution would have been to have all of the XMetaL APIs wrapped in their own namespace. Unfortunately, the Visual Studio wizard does not expose the ability to suppress the use of the `no_namespace` directive which it always injects into the class generation process. I have submitted [an enhancement request](https://developercommunity.visualstudio.com/t/Allow-suppression-of-no_namespace-direct/10206995) to Microsoft for correcting this gap in the IDE's functionality.

### Fix Managled Class Name

In another case, a bug in Visual Studio 2019 transformed the class name `CDocuments` to `Cocuments`. The fix was similar to the workaround for the `CDocument` name conflict:
- rename `Cocuments.h` to `CDocuments.h`
- change all occurrence of "Cocuments" in that header to "CDocuments"

I have confirmed that this bug has been fixed in Visual Studio 2022.
